<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        
<link href="./assets/6993b7a3/css/bootstrap.css" rel="stylesheet">
<link href="./assets/d9ac8fa7/solarized_light.css" rel="stylesheet">
<link href="./assets/1e3cc47/style.css" rel="stylesheet">
<script src="./assets/7bb59eec/jquery.js"></script>
<script src="./assets/6993b7a3/js/bootstrap.js"></script>
<script src="./assets/cd9928dc/jssearch.js"></script>    <title>Dificultades encontradas - Dificultades encontradas - Guía del proyecto</title>
</head>
<body>

<div class="wrap">
    <nav id="w130" class="navbar-inverse navbar-fixed-top navbar"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w130-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./index.html">Guía del proyecto</a></div><div id="w130-collapse" class="collapse navbar-collapse"><ul id="w131" class="navbar-nav nav"><li><a href="./api/index.html">Class reference</a></li>
<li><a href="./README.html">Guide</a></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-120" data-toggle="collapse" data-parent="#navigation">Descripción general <b class="caret"></b></a><div id="navigation-120" class="submenu panel-collapse collapse"><a class="list-group-item" href="./descripcion.html#funcionalidad-principal-de-la-aplicacion">Funcionalidad principal de la aplicación</a>
<a class="list-group-item" href="./descripcion.html#objetivos-generales">Objetivos generales</a>
<a class="list-group-item" href="./descripcion.html#url-del-repositorio">URL del repositorio</a>
<a class="list-group-item" href="./descripcion.html#url-de-la-documentacion">URL de la documentación</a></div>
<a class="list-group-item" href="#navigation-121" data-toggle="collapse" data-parent="#navigation">Instrucciones de instalación y despliegue <b class="caret"></b></a><div id="navigation-121" class="submenu panel-collapse collapse"><a class="list-group-item" href="./instalacion.html#en-local">En local</a>
<a class="list-group-item" href="./instalacion.html#en-la-nube">En la nube</a></div>
<a class="list-group-item" href="#navigation-122" data-toggle="collapse" data-parent="#navigation">Catálogo de requisitos <b class="caret"></b></a><div id="navigation-122" class="submenu panel-collapse collapse"><a class="list-group-item" href="./requisitos.html#cuadro-resumen">Cuadro resumen</a></div>
<a class="list-group-item" href="#navigation-123" data-toggle="collapse" data-parent="#navigation">Manual de usuario <b class="caret"></b></a><div id="navigation-123" class="submenu panel-collapse collapse"><a class="list-group-item" href="./manual.html">Manual de usuario</a></div>
<a class="list-group-item" href="#navigation-124" data-toggle="collapse" data-parent="#navigation">Decisiones adoptadas <b class="caret"></b></a><div id="navigation-124" class="submenu panel-collapse collapse"><a class="list-group-item" href="./decisiones.html">Decisiones adoptadas</a></div>
<a class="list-group-item active" href="#navigation-125" data-toggle="collapse" data-parent="#navigation">Dificultades encontradas <b class="caret"></b></a><div id="navigation-125" class="submenu panel-collapse collapse in"><a class="list-group-item active" href="./dificultades.html">Dificultades encontradas</a></div>
<a class="list-group-item" href="#navigation-126" data-toggle="collapse" data-parent="#navigation">Diagramas <b class="caret"></b></a><div id="navigation-126" class="submenu panel-collapse collapse"><a class="list-group-item" href="./diagramas.html#diagramas-de-clases">Diagramas de clases</a>
<a class="list-group-item" href="./diagramas.html#diagramas-de-estructura-logica-de-datos">Diagramas de estructura lógica de datos</a></div>
<a class="list-group-item" href="#navigation-127" data-toggle="collapse" data-parent="#navigation">Glosario de términos <b class="caret"></b></a><div id="navigation-127" class="submenu panel-collapse collapse"><a class="list-group-item" href="./glosario.html">Glosario de términos</a></div>
<a class="list-group-item" href="#navigation-128" data-toggle="collapse" data-parent="#navigation">Conclusiones <b class="caret"></b></a><div id="navigation-128" class="submenu panel-collapse collapse"><a class="list-group-item" href="./conclusiones.html">Conclusiones</a></div>
<a class="list-group-item" href="#navigation-129" data-toggle="collapse" data-parent="#navigation">Anexos <b class="caret"></b></a><div id="navigation-129" class="submenu panel-collapse collapse"><a class="list-group-item" href="./anexos.html">Anexos</a></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>Dificultades encontradas <span id="dificultades-encontradas"></span><a href="#dificultades-encontradas" class="hashlink">&para;</a></h1><p><strong>Token de autenticación de PayPal.</strong></p>
<p>Para finalizar las compras, creé una acción en el controlador de copias para procesar el carrito y otra para asignar estas copias recién compradas, con el modelo de usuario del comprador.</p>
<p>Cuando el usuario pulsa el botón de PayPal, se ejecuta mediante Ajax la acción de procesar el carrito y ,si da algún error, no permite proceder a la compra. Si por el contrario, no ocurre ningún error, esta genera una token de autenticación que asigna a una cookie y la pasa a la vista de la venta del carrito, donde se recoge con javascript.</p>
<p>Cuando se ha procesado el carrito correctamente, automáticamente se genera el proceso de pago con PayPal y, cuando este pago se realiza correctamente, efectúa otra petición a Ajax, donde se compara la token de autenticación en la cookie con la token pasada por Post a la acción de finalización de la compra. Si los dos tokens coinciden, se procesa el asignado de estas copias nuevas en la propiedad del usuario.</p>
<p>De esta manera, controlo que estas dos acciones se ejecutan seguidamente y que no hay manera posible de finalizar una compra sin antes realizar el pago correctamente.</p>
<p><strong>Globalización de cliente de Amazon S3.</strong></p>
<p>Al usar Amazon S3 para crear una Url firmada que permita ver las fotos, necesitaba una instancia de S3Client. Para crear dicha instancia eran necesarios una serie de parámetros. En vista de que usaría Amazon S3 en muchos lugares de la página, decidí globalizar dichos parámetros (que serían los mismos en su mayoría).</p>
<p>Agregé los parámetros para instanciar el cliente en config/params.php y, al instanciar S3Client, no obtenía los parámetros necesarios del constructor porque se agregaban como un array de configuración. Por lo tanto, no era posible la globalización. Decidí usar por tanto, la clase S3Client solo en los modelos que requirieran contenido multimedia proveniente de Amazon S3.</p>
<p><strong>Creación de ventas con copias o productos</strong></p>
<p>Al crear la tabla ventas, mi idea era que pudieran participar en ellas tanto copias de juegos como productos. Decidí, además, implementar una restricción en la base de datos que consistiera en comprobar que las ventas tendrían tanto copias como productos en sus datos. Tendrían valores nulos alternados, de modo que cuando la venta es de un producto, el valor del id de la copia es nulo, y viceversa.</p>
<p><strong>Relaciones entre usuarios unidireccionales y bidireccionales</strong></p>
<p>Las relaciones entre usuarios están modeladas para que solo puedan existir dos instancias de la base de datos para cada pareja de usuarios. La amistad se define cuando dos usuarios tienen una relación con el estado "1" y no contienen ningún bloqueo entre ellos (relación de estado "3").</p>
<p>La amistad, las peticiones de amistad y las peticiones rechazadas son relaciones bidireccionales que no necesitan más que una relación de cada tipo para definirlas. Sin embargo, las relaciones de bloqueo y seguimiento son relaciones unidireccionales que necesitan un rol para definirse, por lo que en este tipo de relaciones importa quién ha realizado el bloqueo o el seguimiento. Por este motivo, se tiene en cuenta quién es el que ha instanciado la relación, (usuario 1, bloqueador/seguidor), y quién es el "objetivo" de la relación, (usuario2, bloqueado/seguido).</p>
<p><strong>Claves de juegos sin proveedor</strong></p>
<p>Como no tengo contratado un proveedor de claves de juegos digitales, he creado una función que genera claves aleatorias válidas para cada nueva instancia de Copias.</p>
<p><strong>Orden de lista de deseos</strong></p>
<p>Para la lista de deseos de juegos del usuario, he establecido un orden de dichos productos, que se actualiza cada vez que se borra un elemento de la lista. Cuando se agrega un juego a la lista, toma el orden de último en la lista.</p>
<p>Los elementos de innovación de mi proyecto son Amazon Web Services y PayPal.</p>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Tue, 16 Jun 2020 20:31:57 +0000</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script>jQuery(function ($) {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) setTimeout(shiftWindow, 1);
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>
